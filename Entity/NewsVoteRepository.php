<?php

namespace Gpupo\CamelSpiderBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * NewsVoteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class NewsVoteRepository extends EntityRepository
{

    public function getAverageById($news_id)
    {
        $qb = $this->createQueryBuilder('a');
        $qb->add('select', $qb->expr()->avg('a.value'))
            ->add('where', $qb->expr()->eq('a.news', '?1'))
            ->setParameter(1, $news_id);

        return $qb->getQuery();
    }

    public function findVoteByNewsAndUser($news_id, $user_id)
    {
        $qb = $this->createQueryBuilder('a');
        $qb->andWhere($qb->expr()->eq('a.news', '?1'))
            ->andWhere($qb->expr()->eq('a.user', '?2'))
            ->setParameter(1, $news_id)
            ->setParameter(2, $user_id);

        return $qb->getQuery()->getOneOrNullResult();
    }

}
